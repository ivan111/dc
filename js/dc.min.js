var ec=function(){function k(a){console.log(a);throw a;}function G(a,d){return function(){return a[d].apply(a,arguments)}}function l(a){C.add(a)}function h(a){return{type:1,name:a}}function v(a){return{type:2,name:a}}function n(a,d,e){var f,c,z;a.PINS=d;a.action||(a._action?Object.getPrototypeOf(a).action=function(){l(G(this,"_action"))}:Object.getPrototypeOf(a).action=function(){});for(f=0;f<d.length;f++)if(d[f]){switch(d[f].type){case 1:z=new D(a);break;case 2:z=new b;break;case 3:z=null;break;
case 4:z=null;break;default:k("unknown io type")}c=d[f].name;a[c]&&k(c+" exists already");a[c]=z;a["PIN"+(f+1)]=z}if(e)for(e=Array.prototype.slice.call(e,0),f=0;f<e.length;f++)(d=a["PIN"+(f+1)])&&d.connect(e[f]);Object.getPrototypeOf(a).connect=function(a,d){this[a]||k("has not "+a+" pin");this[a].connect(d)}}function g(a){function d(e){this.isConnector=!0;this.inn=new u;this.out=null;a||this.inn.addChangeListener(this);e&&this.addChangeListener(e)}d.prototype.isInput=function(){return a};d.prototype.isOutput=
function(){return!a};d.prototype.isConnected=function(){return this.out?!0:!1};d.prototype.addChangeListener=function(a){this.inn.addChangeListener(a)};d.prototype.connect=function(d){var e;if(d.isWire)e=d,this.out&&k("couldn't connect wire");else if(d.isConnector){this.isOutput()&&d.isOutput()&&k("couldn't connect. output <=> output");this.isInput()&&d.isInput()&&k("couldn't connect. input <=> input");if(this.out&&!d.out){d.connect(this);return}!this.out&&d.out?e=d.out:this.out||d.out?k("couldn't connect. wire <=> wire"):
(e=new u,d.connect(e))}else k("couldn't connect type");this.out=e;a&&e.addChangeListener(this);this.action()};d.prototype.action=function(){this.out&&this.inn.getSignal()!==this.out.getSignal()&&(a?this.inn.setSignal(this.out.getSignal()):this.out.setSignal(this.inn.getSignal()))};d.prototype.getSignal=function(){return this.inn.getSignal()};d.prototype.setSignal=function(d){a&&k("can not set signal to a input connector");this.inn.setSignal(d)};return d}function w(a,d){return function(e,f){for(var b=
0,b=0;b<d.length;b++)if(d[b][0]===e&&d[b][1]===f)return d[b][2];k("["+a+"] Invalid signal. s1 = "+e+", s2 = "+f)}}function q(a,d){function e(){n(this,f,arguments);this._action()}var f=[h("A"),h("B"),v("Y")];e.prototype.name=a;e.prototype._action=function(){var a=d(this.A.getSignal(),this.B.getSignal());this.Y.setSignal(a)};return e}var s,C,E,x,F,A,B,y,u,D,b,c,a,r,f,d,e,z;s=function(a){return("function"===typeof Array.prototype.indexOf?Array.prototype.indexOf:function(a){for(var d=-1,e=-1,d=0;d<this.length;d++)if(this[d]===
a){e=d;break}return e}).call(this,a)};C={isProcessing:!1,queue:[],add:function(a){this.queue.push(a)},start:function(){var a;if(!this.isProcessing){for(this.isProcessing=!0;0<this.queue.length&&this.isProcessing;)a=this.queue.shift(),a();this.isProcessing=!1}},stop:function(){this.isProcessing=!1}};u=function(){function a(){this.instanceNo=d++;this.instanceName="Wire"+this.instanceNo;this.isWire=!0;this._signal=0;this._listeners=[]}var d=0;a.prototype.toString=function(){return this.instanceName};
a.prototype.getSignal=function(){return this._signal};a.prototype.setDelayedSignal=function(a){this.setSignal(a,!0)};a.prototype.setSignal=function(a,d){var e,f;0===a||1===a?this._signal!==a&&(e=this,f=function(){e._signal=a;e.notifyListeners()},d?l(f):f()):k("Invalid signal "+a)};a.prototype.addChangeListener=function(a){-1!==s.call(this._listeners,a)&&k("couldn't add the listener. this listener was already added");this._listeners.push(a)};a.prototype.removeChangeListener=function(a){a=s.call(this._listeners,
a);-1===a&&k("couldn't remove the listener. this listener doesn't exist");this._listeners.splice(a,1)};a.prototype.notifyListeners=function(){var a;for(a=0;a<this._listeners.length;a++)this._listeners[a].action(this._signal)};return a}();D=g(!0);b=g(!1);c=function(){var a=[h("A")];return function(){n(this,a,arguments)}}();a=function(){function a(){n(this,d,arguments)}var d=[v("Y")];a.prototype._action=function(){this.Y.setSignal(this.signal)};return a}();e=function(){function a(){n(this,d,arguments)}
var d=[h("CK"),h("D"),h("CLR_B"),h("PR_B"),v("Q"),v("Q_B")];a.prototype._action=function(){var a=this.CK.getSignal(),d;0===this.CLR_B.getSignal()?(this.Q.setSignal(0),this.Q_B.setSignal(1)):0===this.PR_B.getSignal()?(this.Q.setSignal(1),this.Q_B.setSignal(0)):0===this._prev_ck&&1===a&&(d=this.D.getSignal(),0===d||1===d?(this.Q.setSignal(d),this.Q_B.setSignal(1-d)):(this.Q.setSignal(null),this.Q_B.setSignal(null)));this._prev_ck=a};return a}();E=w("and",[[0,0,0],[0,1,0],[1,0,0],[1,1,1]]);x=w("or",
[[0,0,0],[0,1,1],[1,0,1],[1,1,1]]);F=w("nand",[[0,0,1],[0,1,1],[1,0,1],[1,1,0]]);A=w("nor",[[0,0,1],[0,1,0],[1,0,0],[1,1,0]]);B=w("xor",[[0,0,0],[0,1,1],[1,0,1],[1,1,0]]);y=w("xnor",[[0,0,1],[0,1,0],[1,0,0],[1,1,1]]);r=function(){function a(){n(this,d,arguments);this._action()}var d=[h("A"),v("Y")];a.prototype._action=function(){var a;a=this.A.getSignal();0===a?a=1:1===a?a=0:(k("[not] Invalid signal. s = "+a),a=void 0);this.Y.setSignal(a)};return a}();d=q("and",E);f=q("or",x);E=q("nand",F);A=q("nor",
A);B=q("xor",B);y=q("xnor",y);z=function(){var a=[h("A"),h("B"),v("S"),v("C")];return function(){var e=new u,b=new u;n(this,a,arguments);this.elems=[];this.elems[0]=new f(this.A.inn,this.B.inn,e);this.elems[1]=new d(this.A.inn,this.B.inn,this.C.inn);this.elems[2]=new r(this.C.inn,b);this.elems[3]=new d(e,b,this.S.inn)}}();x=function(){var a=[h("A"),h("B"),h("C_IN"),v("S"),v("C_OUT")];return function(){var d=new u,e=new u,b=new u;n(this,a,arguments);this.elems=[];this.elems[0]=new z(this.B.inn,this.C_IN.inn,
d,e);this.elems[1]=new z(this.A.inn,d,this.S.inn,b);this.elems[2]=new f(e,b,this.C_OUT.inn)}}();return{Wire:u,DummyIN:c,DummyOUT:a,Inverter:r,AndGate:d,OrGate:f,NandGate:E,NorGate:A,XorGate:B,XnorGate:y,DFlipFlop:e,HalfAdder:z,FullAdder:x,delay:l,start:function(){C.start()}}}();var ve=function(){function k(a){console.log(a);throw a;}function G(a,d){return function(){return a[d].apply(a,arguments)}}function l(a,d){return{x:a,y:d,direction:1}}function h(a,d){return{x:a,y:d,direction:2}}function v(a,d,e,b){var c,p,m=0;for(c in e)e.hasOwnProperty(c)&&(p=e[c],(1>p||p>d)&&k("out of pin column index"),p=25*(p-1)+16.5,C.test(c)&&(m=6,b&&(m=-m)),a[c]=b?l(m,p):h(56+m,p))}function n(a,d,e,b){var c,p;this.isFlipped=!1;b?(b=Array.prototype.slice.call(b,0),d.x=b[0]||0,d.y=b[1]||0):(d.x=
0,d.y=0);if(e&&d.cn_pos)for(c in d.cn={},d.cn_pos)d.cn_pos.hasOwnProperty(c)&&(e[c]||k(c+" is not a pin name"),b=new F(a,d,d.cn_pos[c],e[c]),d.cn[c]=b,e[c].addChangeListener(b));if(e&&e.PINS)for(d.PINS=e.PINS,a=0;a<e.PINS.length;a++)e.PINS[a]&&(d[e.PINS[a].name]=e[e.PINS[a].name],d["PIN"+(a+1)]=e["PIN"+(a+1)]);Object.getPrototypeOf(d).setPos=function(a,d){this.x=a;this.y=d};Object.getPrototypeOf(d).flip=function(){this.isFlipped=!this.isFlipped};for(p in e)"function"!==typeof e[p]||d[p]||(d[p]=G(e,
p))}function g(a){a.x=Math.round(a.x);a.y=Math.round(a.y);return a}var w=.5*Math.PI,q=1.5*Math.PI,s=2*Math.PI,C=/_B$/,E=/_\d$/,x,F,A,B,y,u,D,b,c,a,r;x=function(){function a(d){this.ctx=d;this.i=0;this.path=[];this.points=null;this.signal=0;this.cns=[];this.align_tbl={}}a.prototype.draw=function(){var a=this.ctx;this.points&&(this.path.push(this.points),this.points=void 0);0!==this.path.length&&(a.save(),a.lineWidth=3,a.strokeStyle=1===this.signal?"#CC0052":"#00A3CC",a.fillStyle=a.strokeStyle,this._drawSub(),
a.restore())};a.prototype._drawSub=function(){var a,e,b,c=this.ctx;for(a=0;a<this.path.length;a++)if(b=this.path[a],!(2>b.length)){0!==a&&(c.beginPath(),c.arc(b[0].x,b[0].y,4,0,s),c.fill());c.beginPath();c.moveTo(b[0].x,b[0].y);for(e=1;e<b.length;e++)c.lineTo(b[e].x,b[e].y);c.stroke()}};a.prototype.action=function(a){this.signal=a;this.draw()};a.prototype.probe=function(a){var e;a.isWire?(a.addChangeListener(this),e=a.getSignal()):a.isConnector?(a.inn.addChangeListener(this),e=a.inn.getSignal()):
a.isVeConnector?(a.e.inn.addChangeListener(this),e=a.e.inn.getSignal()):k("couldn't probe");this.signal=e};a.prototype.addConnector=function(a){this._prevSignalOnClock=this.signal=a.e.getSignal();this.isClockPath&&a.setClockConnector();this.cns.push(a)};a.prototype.contains=function(a){var e;for(e=0;e<this.cns.length;e++)if(this.cns[e]===a)return!0;return!1};a.prototype.setAlign=function(a,e,b){var c;for(c=0;c<this.cns.length;c++)this.cns[c]===a&&(this.align_tbl[a]||(this.align_tbl[a]=[]),this.align_tbl[a].push({d:b,
type:e}))};a.prototype.moveTo=function(){this.points&&this.path.push(this.points);this.points=[];this.lineTo.apply(this,arguments)};a.prototype.lineTo=function(){var a,e=arguments;0===e.length&&k("no arguments");this.points||k("call moveTo before call lineTo");if("number"===typeof e[0]&&0===e.length%2)for(a=0;a<e.length;a+=2)this.points.push(g({x:e[a],y:e[a+1]}));else if(1===e.length&&"[object Array]"===Object.prototype.toString.call(e[0]))for(a=0;a<e[0].length;a++)this.lineTo(e[0][a]);else 1===e.length&&
e[0].isVeConnector?(a=e[0].getPos(),this.points.push(g({x:a.x,y:a.y}))):1===e.length?this.points.push(g({x:e[0].x,y:e[0].y})):k("invalid arguments")};a.prototype.autoPath=function(a,e){var b,c=a.getPos(),f=e.getPos(),m=a.getDirection(),g=e.getDirection(),r,h,k=0,n=0,l=0,t,q;r=1===m||2===m?!0:!1;h=1===g||2===g?!0:!1;if(this.align_tbl[a])for(t=this.align_tbl[a],b=0;b<t.length;b++)3===t[b].type?n=t[b].d:1===t[b].type?k+=(c.y-f.y)/2:(k=t[b].d,q=t[b].type);if(this.align_tbl[e])for(t=this.align_tbl[e],
b=0;b<t.length;b++)3===t[b].type?l=t[b].d:1===t[b].type?k+=(f.y-c.y)/2:(k=t[b].d,q=t[b].type);k||(k=0);b=20+n;l=20+l;1===m&&(b=-b);1===g&&(l=-l);this.moveTo(c);r!==h?r?this.lineTo(f.x,c.y):this.lineTo(c.x,f.y):2===q?(this.lineTo(c.x+b,c.y),this.lineTo(c.x+b,k),this.lineTo(f.x+l,k),this.lineTo(f.x+l,f.y)):m===g?(this.lineTo(c.x+b,c.y),c.x!==f.x&&(this.lineTo(c.x+b,(c.y+f.y)/2+k),this.lineTo(f.x+l,(c.y+f.y)/2+k)),this.lineTo(f.x+l,f.y)):(r&&this.lineTo(c.x+b,c.y),c.y!==f.y&&(this.lineTo(c.x+b,(c.y+
f.y)/2+k),this.lineTo(f.x+l,(c.y+f.y)/2+k)),h&&this.lineTo(f.x+l,f.y));this.lineTo(f)};a.prototype.searchNearestPoint=function(a){var b,c,f,p,m,g=9999,r={x:a.x,y:a.y};for(p=0;p<this.path.length;p++)for(m=this.path[p],f=0;f<m.length-1;f++){b=m[f];var h=m[f+1],l=a,n=9999;c={x:0,y:0};var q=void 0,t=void 0;b.x===h.x?(q=Math.min(b.y,h.y),t=Math.max(b.y,h.y),q-1<=l.y&&l.y<=t+1&&(n=Math.abs(b.x-l.x),c={x:b.x,y:l.y})):b.y===h.y?(q=Math.min(b.x,h.x),t=Math.max(b.x,h.x),q-1<=l.x&&l.x<=t+1&&(n=Math.abs(b.y-
l.y),c={x:l.x,y:b.y})):k("calcDist error");b=n;b<g&&(g=b,r=c)}return r};a.prototype.addAutoPath=function(a){var b=a.getPos(),c={},f,p;f=0;var m=a.getDirection();this.moveTo({x:0,y:0});0===this.path.length&&k("can't addAutoPath to empty path");if(this.align_tbl[a])for(p=this.align_tbl[a],a=0;a<p.length;a++)3===p[a].type&&(f=p[a].d);f||(f=0);c.x=1===m?b.x-20-f:b.x+20+f;c.y=b.y;f=this.searchNearestPoint(c);this.points[0]=g(f);this.lineTo(c);this.lineTo(b)};a.prototype.getPrev=function(){var a;0===this.points.length&&
k("couldn't get prev point");a=this.points.length-1;return{x:this.points[a].x,y:this.points[a].y}};a.prototype.left=function(a){var b=this.getPrev();this.points.push(g({x:b.x-a,y:b.y}))};a.prototype.right=function(a){var b=this.getPrev();this.points.push(g({x:b.x+a,y:b.y}))};a.prototype.up=function(a){var b=this.getPrev();this.points.push(g({x:b.x,y:b.y-a}))};a.prototype.down=function(a){var b=this.getPrev();this.points.push(g({x:b.x,y:b.y+a}))};a.prototype.calc=function(){var a,b=-1,c,f,p,m;if(!(2>
this.cns.length)){m=this.cns.slice(0);a=[m[0],m[1]];if(2<m.length)for(c=0;c<m.length-1;c++)for(f=c+1;f<m.length;f++){p=m[c].getPos();var g=m[f].getPos(),h=void 0,r=void 0,h=g.x-p.x,r=g.y-p.y;p=Math.sqrt(h*h+r*r);p>b&&(b=p,a=[m[c],m[f]])}for(f=0;2>f;f++)for(c=0;c<m.length;c++)if(m[c]===a[f]){m.splice(c,1);break}this.autoPath(a[0],a[1]);for(c=0;c<m.length;c++)this.addAutoPath(m[c])}};return a}();F=function(){function a(b,c,f,p){var m;this.ctx=b;this.instanceNo=d++;this.instanceName="ViConnector"+this.instanceNo;
this.isVeConnector=!0;this.parent=c;this.cn_pos=f;this.e=p;for(m in p)"function"!==typeof p[m]||this[m]||(this[m]=G(p,m))}var d=0;a.prototype.toString=function(){return this.instanceName};a.prototype.draw=function(){var a=0,d=this.ctx;1===this.cn_pos.direction?a=-4:2===this.cn_pos.direction&&(a=4);this.parent.isFlipped&&(a=-a);d.save();d.fillStyle=1===this.signal?"#CC0052":"#00A3CC";d.beginPath();d.arc(this.getX()+a,this.getY(),4,0,s);d.fill();d.restore()};a.prototype.action=function(){this.signal=
this.e.getSignal();this.draw()};a.prototype.getDirection=function(){var a=this.cn_pos.direction;if(this.parent.isFlipped){if(1===a)return 2;if(2===a)return 1}return a};a.prototype.getPos=function(){return{x:this.getX(),y:this.getY()}};a.prototype.getX=function(){return this.parent.isFlipped?this.parent.x-this.cn_pos.x:this.parent.x+this.cn_pos.x};a.prototype.getY=function(){return this.parent.y+this.cn_pos.y};return a}();y=function(){function a(d){var b;this.ctx=d;this.e=new ec.Inverter;this.h=this.w=
50;b=Array.prototype.slice.call(arguments,1);n(d,this,this.e,b)}a.prototype.cn_pos={A:l(0,25),Y:h(60,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(-25,-25);a.lineTo(-25,25);a.lineTo(25,0);a.closePath();a.stroke();a.beginPath();a.arc(30,0,5,0,s);a.stroke();a.restore()};return a}();u=function(){function a(d){var b;this.ctx=d;this.e=new ec.AndGate;this.h=this.w=50;b=Array.prototype.slice.call(arguments,1);
n(d,this,this.e,b)}a.prototype.cn_pos={A:l(0,12.5),B:l(0,37.5),Y:h(50,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(0,-25);a.lineTo(-25,-25);a.lineTo(-25,25);a.lineTo(0,25);a.stroke();a.beginPath();a.arc(0,0,25,q,w);a.stroke();a.restore()};return a}();D=function(){function a(d){var b;this.ctx=d;this.e=new ec.OrGate;this.h=this.w=50;b=Array.prototype.slice.call(arguments,1);n(d,this,this.e,b)}a.prototype.cn_pos=
{A:l(12,12.5),B:l(12,37.5),Y:h(50,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(-25,-25);a.quadraticCurveTo(12.5,-25,25,0);a.quadraticCurveTo(12.5,25,-25,25);a.quadraticCurveTo(0,0,-25,-25);a.stroke();a.restore()};return a}();b=function(){function a(d){var b;this.ctx=d;this.e=new ec.NandGate;this.h=this.w=50;b=Array.prototype.slice.call(arguments,1);n(d,this,this.e,b)}a.prototype.cn_pos={A:l(0,12.5),B:l(0,
37.5),Y:h(62,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(0,-25);a.lineTo(-25,-25);a.lineTo(-25,25);a.lineTo(0,25);a.stroke();a.beginPath();a.arc(0,0,25,q,w);a.stroke();a.beginPath();a.arc(31,0,6,0,s);a.stroke();a.restore()};return a}();c=function(){function a(b){var c;this.ctx=b;this.e=new ec.NorGate;this.h=this.w=50;c=Array.prototype.slice.call(arguments,1);n(b,this,this.e,c)}a.prototype.cn_pos={A:l(12,
12.5),B:l(12,37.5),Y:h(60,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(-25,-25);a.quadraticCurveTo(12.5,-25,25,0);a.quadraticCurveTo(12.5,25,-25,25);a.quadraticCurveTo(0,0,-25,-25);a.stroke();a.beginPath();a.arc(30,0,5,0,s);a.stroke();a.restore()};return a}();a=function(){function a(b){var c;this.ctx=b;this.e=new ec.XorGate;this.h=this.w=50;c=Array.prototype.slice.call(arguments,1);n(b,this,this.e,c)}
a.prototype.cn_pos={A:l(12,12.5),B:l(12,37.5),Y:h(50,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(-25,-25);a.quadraticCurveTo(12.5,-25,25,0);a.quadraticCurveTo(12.5,25,-25,25);a.quadraticCurveTo(0,0,-25,-25);a.stroke();a.beginPath();a.moveTo(-30,-25);a.quadraticCurveTo(-5,-5,-30,25);a.stroke();a.restore()};return a}();r=function(){function a(b){var c;this.ctx=b;this.e=new ec.XnorGate;this.h=this.w=50;
c=Array.prototype.slice.call(arguments,1);n(b,this,this.e,c)}a.prototype.cn_pos={A:l(12,12.5),B:l(12,37.5),Y:h(60,25)};a.prototype.draw=function(){var a=this.ctx;a.save();a.translate(this.x+25,this.y+25);this.isFlipped&&a.scale(-1,1);a.beginPath();a.moveTo(-25,-25);a.quadraticCurveTo(12.5,-25,25,0);a.quadraticCurveTo(12.5,25,-25,25);a.quadraticCurveTo(0,0,-25,-25);a.stroke();a.beginPath();a.moveTo(-30,-25);a.quadraticCurveTo(-5,-5,-30,25);a.stroke();a.beginPath();a.arc(30,0,5,0,s);a.stroke();a.restore()};
return a}();A=function(){function a(b,c){var f;this.ctx=b;this.label=c;this.e=new ec.DummyIN;this.labelY=this.labelX=this.h=this.w=0;f=Array.prototype.slice.call(arguments,2);n(b,this,this.e,f)}a.prototype.cn_pos={A:l(0,0)};a.prototype.setLabelPos=function(a,b){this.labelX=a;this.labelY=b};a.prototype.draw=function(){var a=this.ctx;a.save();a.font="18px Arial";a.fillStyle="black";a.textAlign="left";a.translate(this.x,this.y);a.fillText(this.label,4+this.labelX,6+this.labelY);a.restore()};return a}();
B=function(){function a(b,c){var f;this.ctx=b;this.label=c;this.e=new ec.DummyOUT;this.labelY=this.labelX=this.h=this.w=0;f=Array.prototype.slice.call(arguments,2);n(b,this,this.e,f)}a.prototype.cn_pos={Y:h(0,0)};a.prototype.setLabelPos=function(a,b){this.labelX=a;this.labelY=b};a.prototype.draw=function(){var a=this.ctx;a.save();a.font="18px Arial";a.fillStyle="black";a.textAlign="right";a.translate(this.x,this.y);a.fillText(this.label,-4+this.labelX,6+this.labelY);a.restore()};return a}();return{createDIP_IC:function(a,
b,c,g){function h(b){var c;this.ctx=b;this.e=new a;this.w=56;this.h=p;c=Array.prototype.slice.call(arguments,1);n(b,this,this.e,c)}var p=25*b+8;h.prototype.cn_pos={};v(h.prototype.cn_pos,b,c,!0);v(h.prototype.cn_pos,b,g,!1);h.prototype.draw=function(){var a=this.ctx,b,c,d,e,f,h,g,r,k;a.save();a.translate(this.x,this.y);this.isFlipped&&a.scale(-1,1);a.beginPath();a.strokeStyle="black";a.fillStyle="white";a.lineWidth=2;a.rect(0,0,56,p);a.shadowColor="#999";a.shadowBlur=3;a.shadowOffsetX=3;a.shadowOffsetY=
3;a.stroke();a.fill();a.font="18px Arial";a.shadowColor="transparent";a.lineWidth=1;a.fillStyle="black";for(b in this.cn_pos)this.cn_pos.hasOwnProperty(b)&&(d=this.cn_pos[b],c=b,(e=C.test(b))&&(c=c.substr(0,c.length-2)),E.test(c)&&(c=c.charAt(c.length-1)+c.substr(0,c.length-2)),e=C.test(b),2===d.direction?(a.textAlign="right",f=56,h=d.x-6,g=f-6,r=g-a.measureText(c).width,k=f-6):(a.textAlign="left",f=0,h=d.x+6,g=f+6,r=g+a.measureText(c).width,k=f+6),e&&(a.beginPath(),a.arc(h,d.y,6,0,s),a.stroke(),
a.beginPath(),a.moveTo(g,d.y-5),a.lineTo(r,d.y-5),a.stroke()),"CK"===b&&(a.beginPath(),a.moveTo(f,d.y-6),a.lineTo(k,d.y),a.lineTo(f,d.y+6),a.stroke()),a.fillText(c,g,d.y+6));a.restore()};return h},createAutoPath:function(a,b){function c(){var e,g,h,r,k,l;this.wire2cn={};this.paths=[];for(g in b)if(b.hasOwnProperty(g))for(r in e=b[g],h=e.cn_pos,h)h.hasOwnProperty(r)&&(k=e[r].out)&&(this.wire2cn[k]||(this.wire2cn[k]=[k]),this.wire2cn[k].push(e.cn[r]));for(l in this.wire2cn)if(this.wire2cn.hasOwnProperty(l))for(h=
this.wire2cn[l],g=new x(a),g.probe(h[0]),this.paths.push(g),e=1;e<h.length;e++)g.addConnector(h[e])}var g,h;if("[object Array]"===Object.prototype.toString.call(b)){h={};for(g=0;g<b.length;g++)h["e"+g]=b[g];b=h}c.prototype.setAlign=function(a,b,c){var d;for(d=0;d<this.paths.length;d++)if(this.paths[d].contains(a)){this.paths[d].setAlign(a,b,c);break}};c.prototype.calc=function(){var a;for(a=0;a<this.paths.length;a++)this.paths[a].calc()};c.prototype.getPath=function(a){var b;for(b=0;b<this.paths.length;b++)if(this.paths[b].contains(a))return this.paths[b]};
c.prototype.draw=function(){var a;for(a=0;a<this.paths.length;a++)this.paths[a].draw()};return new c},drawLabel:function(a,b,c,g){var h;a.save();a.font="16px Arial";a.textAlign="center";a.fillStyle="black";h=c.x+c.w/2;4===g?a.fillText(b,h,c.y+c.h+20):a.fillText(b,h,c.y-6);a.restore()},DIP_WIDTH:56,DIP_H_UNIT:25,DIP_H_PAD:4,ALIGN_MID:0,ALIGN_PIN:1,ALIGN_PIN_TURN:3,ALIGN_TOP:2,T_LEFT:1,T_RIGHT:2,T_UP:3,T_DOWN:4,DummyIN:A,DummyOUT:B,Path:x,Inverter:y,AndGate:u,OrGate:D,NandGate:b,NorGate:c,XorGate:a,
XnorGate:r}}();dc=function(){function k(b,c,a,g){var f;c+=C++;f=$('<div class="dc-schematic"></div>');c=$(['<canvas id="',c,'" width="',a,'" height="',g,'">Canvas not supported</canvas>'].join(""));f.append(c);b.append(f);b=c[0].getContext("2d");b.beginPath();b.fillStyle="#EEE";b.rect(0,0,a,g);b.fill();return b}function G(b,c,a,g){var f="dc-sw"+E++,d;d=$('<div class="onoffswitch"></div>');d.append('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="{{ID_NAME}}"><label class="onoffswitch-label" for="{{ID_NAME}}"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch"></span></label>'.replace("{{ID_NAME}}",
f).replace("{{ID_NAME}}",f));f=b.find("canvas")[0].getBoundingClientRect();d.css({position:"absolute",left:f.left+a-50,top:f.top+g-12});b.append(d);b=d.find("input[type=checkbox]");b.change(function(){$(this).is(":checked")?c.inn.setSignal(1):c.inn.setSignal(0);ec.start()});return b}function l(b,c,a){var g,f,d,e,h,k,p;for(f in a)if(a.hasOwnProperty(f))for(d in g=a[f],g.cn)g.cn.hasOwnProperty(d)&&(e=g.cn[d],e.isConnected()||(h=new ve.Path(c),h.probe(e),h.moveTo(e),k=e.getX(),p=e.getY(),e.getDirection()===
ve.T_LEFT?(h.left(52),k-=52):(h.right(52),k+=52),e.isInput()&&G(b,e.e,k,p),h.draw()))}function h(b,c,a,g){var f;a||(a=0);g||(g=0);b.isVeConnector?(f=b.parent,a-=b.cn_pos.x,g-=b.cn_pos.y):f=b;c.isVeConnector?(b=c.getX(),c=c.getY()):(b=c.x,c=c.y);f.x=b+a;f.y=c+g;return f}function v(b,c,a){function g(){}g.prototype.action=function(){b.find("tr.selected").removeClass("selected");b.find("tr").each(function(f){var d,e=!0,g=[];if(!(2>f)){for(d=0;d<a.length;d++)g.push(a[d].getSignal());$(this).find("td").each(function(b){var d;
b<a.length&&(d=c[f][0][b],"X"!==d&&d!==g[b]&&(e=!1))});e&&$(b.find("tr")[f]).addClass("selected")}})};return new g}function n(b,c){var a,g=c.slice(0),f=c.shift().slice(0).shift(),d=c.shift().slice(0),e=d.shift(),h=d.shift(),k,l,m,n,d=$('<table class="dc-truth-table"></table>');a=$("<tr></tr>");d.append(a);1===e.length?a.append($("<th>INPUT</th>")):a.append($(['<th colspan="',e.length,'">INPUT</th>'].join("")));1===h.length?a.append($('<th class="dc-output-start">OUTPUT</th>')):a.append($(['<th class="dc-output-start" colspan="',
h.length,'">OUTPUT</th>'].join("")));m=$("<tr></tr>");d.append(m);for(a=0;a<e.length;a++)m.append($(["<th>",e[a],"</th>"].join("")));for(a=0;a<h.length;a++)k=$(["<th>",h[a],"</th>"].join("")),0===a&&k.addClass("dc-output-start"),m.append(k);for(m=function(){var a,b=$(this).index(),c;if(!$(this).hasClass("selected"))for(a=0;a<f.length;a++)c=g[b][0][a],"X"!==c&&c!==f[a].getSignal()&&f[a].$sw.click()};c.length;){a=c.shift().slice(0);k=a.shift();l=a.shift();n=$("<tr></tr>");d.append(n);for(a=0;a<e.length;a++)n.append($(["<td>",
k[a],"</td>"].join("")));for(a=0;a<h.length;a++)k=$(["<td>",l[a],"</td>"].join("")),0===a&&k.addClass("dc-output-start"),n.append(k);n.click(m)}e=v(d,g,f);for(a=0;a<f.length;a++)f[a].addChangeListener(e);$(d.find("tr")[2]).addClass("selected");b.append(d);b.append($('<div style="clear: both;"></div>'));return d}function g(b,c,a,g,f,d){var e;e=g[f];g=g.cn[f];e.isInput()?(c=new ve.DummyOUT(c,a),a=c.Y,f=c.cn.Y,c.setLabelPos(-50,0),d||(d=-52)):(c=new ve.DummyIN(c,a),a=c.A,f=c.cn.A,d||(d=52));a.connect(e);
h(f,g,d,0);a.isOutput()&&(c.Y.$sw=G(b,a,f.getX(),f.getY()));return c}function w(b,c){var a=c.Y.$sw.parent(),g;g=b.find("canvas")[0].getBoundingClientRect();a.css({position:"absolute",left:g.left+c.cn.Y.getX()-50,top:g.top+c.cn.Y.getY()-12})}function q(b,c){var a,g;for(a in b)if(b.hasOwnProperty(a))for(g in b[a].draw(),b[a].cn_pos)b[a].cn_pos.hasOwnProperty(g)&&b[a].cn[g].action();c&&(c.calc(),c.draw())}function s(b,c,a,h){return function(f){var d,e={},s;d=k(f,c,360,100);e.gate=new b(d,140,20);s=["A",
a,"B"].join(" ");e.a=g(f,d,"A",e.gate,"A");e.b=g(f,d,"B",e.gate,"B");e.y=g(f,d,s,e.gate,"Y");l(f,d,e);h.unshift([["A","B"],[s]]);h.unshift([[e.a.Y,e.b.Y],[e.gate.Y]]);n(f,h);f=ve.createAutoPath(d,e);q(e,f)}}var C=0,E=0,x,F,A,B,y,u,D;D=ve.createDIP_IC(ec.HalfAdder,2,{A:1,B:2},{C:1,S:2});x=s(ve.AndGate,"dc-and-canvas","AND",[[[0,0],[0]],[[0,1],[0]],[[1,0],[0]],[[1,1],[1]]]);F=s(ve.OrGate,"dc-or-canvas","OR",[[[0,0],[0]],[[0,1],[1]],[[1,0],[1]],[[1,1],[1]]]);A=s(ve.NandGate,"dc-nand-canvas","NAND",[[[0,
0],[1]],[[0,1],[1]],[[1,0],[1]],[[1,1],[0]]]);B=s(ve.NorGate,"dc-nor-canvas","NOR",[[[0,0],[1]],[[0,1],[0]],[[1,0],[0]],[[1,1],[0]]]);y=s(ve.XorGate,"dc-xor-canvas","XOR",[[[0,0],[0]],[[0,1],[1]],[[1,0],[1]],[[1,1],[0]]]);y=s(ve.XorGate,"dc-xor-canvas","XOR",[[[0,0],[0]],[[0,1],[1]],[[1,0],[1]],[[1,1],[0]]]);u=s(ve.XnorGate,"dc-xnor-canvas","XNOR",[[[0,0],[1]],[[0,1],[0]],[[1,0],[0]],[[1,1],[1]]]);return{createAndGate:x,createOrGate:F,createNotGate:function(b){var c,a={};c=k(b,"dc-not-canvas",360,
100);a.gate=new ve.Inverter(c,140,20);a.a=g(b,c,"A",a.gate,"A");a.y=g(b,c,"NOT A",a.gate,"Y");l(b,c,a);n(b,[[[a.a.Y],[a.gate.Y]],[["A"],["NOT A"]],[[0],[1]],[[1],[0]]]);b=ve.createAutoPath(c,a);q(a,b)},createNandGate:A,createNorGate:B,createXorGate:y,createXnorGate:u,createSRFlipFlopNor:function(b){var c,a={};c=k(b,"dc-sr-flip-flop-nor-canvas",360,200);a.nor1=new ve.NorGate(c,140,20);a.nor2=new ve.NorGate(c);h(a.nor2,a.nor1,0,100);a.r=g(b,c,"R",a.nor1,"A",-52);a.s=g(b,c,"S",a.nor2,"B",-52);a.q=g(b,
c,"Q",a.nor1,"Y");a.q_b=g(b,c,"Q'",a.nor2,"Y");a.nor1.Y.connect(a.nor2.A);a.nor2.Y.connect(a.nor1.B);n(b,[[[a.s.Y,a.r.Y],[a.q.A,a.q_b.A]],[["S","R"],["Q","Q'"]],[[0,0],["Q","Q'"]],[[0,1],[0,1]],[[1,0],[1,0]],[[1,1],["X","X"]]]);b=ve.createAutoPath(c,a);b.setAlign(a.nor1.cn.B,ve.ALIGN_PIN_TURN,20);b.setAlign(a.nor1.cn.B,ve.ALIGN_MID,6);b.setAlign(a.nor2.cn.A,ve.ALIGN_MID,-6);q(a,b);a.r.Y.$sw.click()},createSRFlipFlopNand:function(b){var c,a={};c=k(b,"dc-sr-flip-flop-nand-canvas",360,200);a.nand1=new ve.NandGate(c,
140,20);a.nand2=new ve.NandGate(c);h(a.nand2,a.nand1,0,100);a.r=g(b,c,"R'",a.nand1,"A",-52);a.s=g(b,c,"S'",a.nand2,"B",-52);a.q=g(b,c,"Q",a.nand1,"Y");a.q_b=g(b,c,"Q'",a.nand2,"Y");a.nand1.Y.connect(a.nand2.A);a.nand2.Y.connect(a.nand1.B);n(b,[[[a.s.Y,a.r.Y],[a.q.A,a.q_b.A]],[["S'","R'"],["Q","Q'"]],[[0,0],["X","X"]],[[0,1],[0,1]],[[1,0],[1,0]],[[1,1],["Q","Q'"]]]);b=ve.createAutoPath(c,a);b.setAlign(a.nand1.cn.B,ve.ALIGN_PIN_TURN,20);b.setAlign(a.nand1.cn.B,ve.ALIGN_MID,6);b.setAlign(a.nand2.cn.A,
ve.ALIGN_MID,-6);q(a,b);a.r.Y.$sw.click()},createClockedSRFlipFlop:function(b){var c,a={};c=k(b,"dc-clocked-sr-flip-flop-canvas",460,240);a.and1=new ve.AndGate(c,160,20);a.and2=new ve.AndGate(c);a.nor1=new ve.NorGate(c);a.nor2=new ve.NorGate(c);h(a.and2,a.and1,0,140);h(a.nor1.cn.A,a.and1.cn.Y,80);h(a.nor2.cn.B,a.and2.cn.Y,80);a.r=g(b,c,"R",a.and1,"A");a.e=g(b,c,"E",a.and1,"B");a.s=g(b,c,"S",a.and2,"B");a.q=g(b,c,"Q",a.nor1,"Y");a.q_b=g(b,c,"Q'",a.nor2,"Y");a.e.x=a.r.x;a.e.y=(a.and1.cn.B.getY()+a.and2.cn.A.getY())/
2;w(b,a.e);a.e.Y.connect(a.and2.A);a.and1.Y.connect(a.nor1.A);a.and2.Y.connect(a.nor2.B);a.nor1.Y.connect(a.nor2.A);a.nor2.Y.connect(a.nor1.B);n(b,[[[a.e.Y,a.s.Y,a.r.Y],[a.q.A,a.q_b.A]],[["E","S","R"],["Q","Q'"]],[[0,"X","X"],["Q","Q'"]],[[1,0,0],["Q","Q'"]],[[1,0,1],[0,1]],[[1,1,0],[1,0]],[[1,1,1],["-","-"]]]);b=ve.createAutoPath(c,a);b.setAlign(a.and2.cn.B,ve.ALIGN_PIN,0);b.setAlign(a.e.cn.Y,ve.ALIGN_PIN,0);b.setAlign(a.nor1.cn.B,ve.ALIGN_MID,10);b.setAlign(a.nor2.cn.A,ve.ALIGN_MID,-10);b.setAlign(a.nor1.cn.B,
ve.ALIGN_PIN_TURN,20);q(a,b);a.r.Y.$sw.click();a.e.Y.$sw.click()},createDFlipFlopNor:function(b){var c,a={};c=k(b,"dc-d-flip-flop-nor-canvas",460,240);a.nand1=new ve.NandGate(c,140,20);a.nand2=new ve.NandGate(c);a.nand3=new ve.NandGate(c);a.nand4=new ve.NandGate(c);h(a.nand2,a.nand1,0,140);h(a.nand3.cn.A,a.nand1.cn.Y,80);h(a.nand4.cn.B,a.nand2.cn.Y,80);a.d=g(b,c,"D",a.nand1,"A",-72);a.e=g(b,c,"E",a.nand2,"B",-72);a.q=g(b,c,"Q",a.nand3,"Y");a.q_b=g(b,c,"Q'",a.nand4,"Y");a.nand1.B.connect(a.e.Y);a.nand1.Y.connect(a.nand3.A);
a.nand1.Y.connect(a.nand2.A);a.nand2.Y.connect(a.nand4.B);a.nand3.Y.connect(a.nand4.A);a.nand4.Y.connect(a.nand3.B);n(b,[[[a.e.Y,a.d.Y],[a.q.A,a.q_b.A]],[["E","D"],["Q","Q'"]],[[0,"X"],["Q","Q'"]],[[1,0],[0,1]],[[1,1],[1,0]]]);b=ve.createAutoPath(c,a);b.setAlign(a.nand1.cn.B,ve.ALIGN_PIN,0);b.setAlign(a.nand3.cn.B,ve.ALIGN_MID,10);b.setAlign(a.nand4.cn.A,ve.ALIGN_MID,-10);b.setAlign(a.nand3.cn.A,ve.ALIGN_PIN_TURN,40);b.setAlign(a.nand3.cn.B,ve.ALIGN_PIN_TURN,20);q(a,b);a.e.Y.$sw.click()},createDFlipFlopNand:function(b){var c,
a={};c=k(b,"dc-d-flip-flop-nand-canvas",540,240);a.not=new ve.Inverter(c,160,20);a.and1=new ve.AndGate(c);a.and2=new ve.AndGate(c);a.nor1=new ve.NorGate(c);a.nor2=new ve.NorGate(c);h(a.and1.cn.A,a.not.cn.Y,40);h(a.and2,a.and1,0,140);h(a.nor1.cn.A,a.and1.cn.Y,80);h(a.nor2.cn.B,a.and2.cn.Y,80);a.d=g(b,c,"D",a.not,"A",-72);a.e=g(b,c,"E",a.and1,"B",-72);a.q=g(b,c,"Q",a.nor1,"Y");a.q_b=g(b,c,"Q'",a.nor2,"Y");a.e.x=a.d.x;a.e.y=(a.and1.cn.B.getY()+a.and2.cn.A.getY())/2;w(b,a.e);a.not.Y.connect(a.and1.A);
a.e.Y.connect(a.and2.A);a.d.Y.connect(a.and2.B);a.and1.Y.connect(a.nor1.A);a.and2.Y.connect(a.nor2.B);a.nor1.Y.connect(a.nor2.A);a.nor2.Y.connect(a.nor1.B);n(b,[[[a.e.Y,a.d.Y],[a.q.A,a.q_b.A]],[["E","D"],["Q","Q'"]],[[0,"X"],["Q","Q'"]],[[1,0],[0,1]],[[1,1],[1,0]]]);b=ve.createAutoPath(c,a);b.setAlign(a.and2.cn.B,ve.ALIGN_PIN,0);b.setAlign(a.e.cn.Y,ve.ALIGN_PIN,0);b.setAlign(a.nor1.cn.B,ve.ALIGN_MID,10);b.setAlign(a.nor2.cn.A,ve.ALIGN_MID,-10);b.setAlign(a.d.cn.Y,ve.ALIGN_PIN_TURN,20);b.setAlign(a.nor1.cn.B,
ve.ALIGN_PIN_TURN,20);q(a,b);a.e.Y.$sw.click()},createHalfAdder:function(b){var c,a={};c=k(b,"dc-half-adder-canvas",360,180);a.xor=new ve.XorGate(c,180,20);a.and=new ve.AndGate(c);h(a.and,a.xor,0,80);a.a=g(b,c,"A",a.xor,"A",-104);a.b=g(b,c,"B",a.xor,"B",-104);a.s=g(b,c,"S",a.xor,"Y");a.c=g(b,c,"C",a.and,"Y");a.a.Y.connect(a.and.A);a.b.Y.connect(a.and.B);n(b,[[[a.a.Y,a.b.Y],[a.s.A,a.c.A]],[["A","B"],["S","C"]],[[0,0],[0,0]],[[0,1],[1,0]],[[1,0],[1,0]],[[1,1],[0,1]]]);b=ve.createAutoPath(c,a);b.setAlign(a.and.cn.A,
ve.ALIGN_PIN,0);b.setAlign(a.and.cn.B,ve.ALIGN_PIN,0);q(a,b)},createHalfAdder2:function(b){var c,a={};c=k(b,"dc-half-adder2-canvas",540,220);a.or=new ve.OrGate(c,180,20);a.and1=new ve.AndGate(c);a.not=new ve.Inverter(c);a.and2=new ve.AndGate(c);h(a.and1,a.or,0,100);h(a.not,a.or,90,50);h(a.and2.cn.A,a.or.cn.Y,140);a.a=g(b,c,"A",a.or,"A",-104);a.b=g(b,c,"B",a.and1,"B",-92);a.s=g(b,c,"S",a.and2,"Y");a.c=g(b,c,"C",a.and1,"Y");a.c.x=a.s.x;a.a.Y.connect(a.and1.A);a.b.Y.connect(a.or.B);a.and2.A.connect(a.or.Y);
a.and2.B.connect(a.not.Y);a.not.A.connect(a.and1.Y);n(b,[[[a.a.Y,a.b.Y],[a.s.A,a.c.A]],[["A","B"],["S","C"]],[[0,0],[0,0]],[[0,1],[1,0]],[[1,0],[1,0]],[[1,1],[0,1]]]);b=ve.createAutoPath(c,a);b.setAlign(a.and2.cn.B,ve.ALIGN_PIN,0);b.setAlign(a.a.cn.Y,ve.ALIGN_PIN,0);b.setAlign(a.or.cn.B,ve.ALIGN_PIN_TURN,40);b.setAlign(a.b.cn.Y,ve.ALIGN_PIN,0);q(a,b)},createFullAdder:function(b){var c,a={};c=k(b,"dc-full-adder-canvas",570,160);a.ha1=new D(c,150,40);a.ha2=new D(c);a.or=new ve.OrGate(c);h(a.ha2.cn.A,
a.ha1.cn.S,60);h(a.or.cn.A,a.ha1.cn.C,200);a.a=g(b,c,"A",a.ha1,"A");a.b=g(b,c,"B",a.ha1,"B");a.cin=g(b,c,"Cin",a.ha2,"B");a.s=g(b,c,"S",a.ha2,"S");a.cout=g(b,c,"Cout",a.or,"Y");a.s.x=a.cout.x;a.cin.x=a.b.x;w(b,a.cin);a.ha1.S.connect(a.ha2.A);a.ha1.C.connect(a.or.A);a.ha2.C.connect(a.or.B);n(b,[[[a.a.Y,a.b.Y,a.cin.Y],[a.cout.A,a.s.A]],[["A","B","Cin"],["Cout","S"]],[[0,0,0],[0,0]],[[1,0,0],[0,1]],[[0,1,0],[0,1]],[[1,1,0],[1,0]],[[0,0,1],[0,1]],[[1,0,1],[1,0]],[[0,1,1],[1,0]],[[1,1,1],[1,1]]]);b=ve.createAutoPath(c,
a);b.setAlign(a.ha1.cn.S,ve.ALIGN_PIN,0);b.setAlign(a.s.cn.A,ve.ALIGN_PIN,0);b.setAlign(a.ha2.cn.C,ve.ALIGN_PIN,0);q(a,b);ve.drawLabel(c,"Half Adder",a.ha1);ve.drawLabel(c,"Half Adder",a.ha2,ve.T_DOWN)}}}();
